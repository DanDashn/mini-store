<?php
        require_once 'conn/conn.php';
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div class="head-ball-container">
        <div class="head-ball-container2">
            <div class="head-logo-cont">
            <img  src="img/books.png" width="50" alt="logo"> Магазин книг
            </div>
            <div class="ball-container">
                <b id="ner"></b> руб.
            </div>  
        </div>
    </div>
    <div class="store-container">
        <div class="left-cont">
            <div class="param-cont">
                <div class="param-1">
                    Сортировать по цене <img src="img/sort.png" width="16" alt="">
                </div>
                <div class="param-2">
                        <select name="cotegories" id="">
                            <option value="0">Категория</option>
                            <option value="1">Дизайн</option>
                            <option value="2">Управление проектами</option>
                            <option value="3">Разработка</option>
                            <option value="4">Тестирование</option>
                        </select>
                </div>
                <div class="right-cont-header-mini">
                    <img src="img/free-icon-purchase-7078316.png" width="50" alt="Корзина">
                </div>
                <div class="param-3">
                    <form>
                        <input type="text" name="search" placeholder="Введите название книги">
                      </form>
                </div>
            </div>
            <div class="books-item-cont">
                <div>
                    <?php
                        $tovari = mysqli_query($lin_handler, " SELECT  v.id, v.veloname, b.name,  v.razmer, v.veloimg, v.price FROM veloes v
                        left join brands b on v.id_velobrand=b.idbrands");
                        $tovari= mysqli_fetch_all($tovari);
                        foreach ($tovari as $tovar) {
                        ?>
                    <div class="books-item-oneis">
                        <div class="book-img-cont"><img class="book-img" src="<?= $tovar[4] ?>" alt=""></div>
                        <div class="book-header-cont"><?= $tovar[1] ?></div>
                        <div class="book-params">
                            <p>Маркка:<?= $tovar[2] ?> <br>
                            Радиус колеса: <?= $tovar[3] ?></p>
                        </div>
                        <div class="book-price-cont"><?= $tovar[5] ?> руб</div>
                        <div class="book-buy-cont"><button class="add-to-cart" data-articul="<?= $tovar[0] ?>">В корзину</button></div>
                    </div>
                    <?php
                    }?>

                    <?php   
                        $motoes = mysqli_query($lin_handler, "SELECT m.id, m.motoname, b.name as 'motobrand', m.price, m.motoimg FROM motoes m
                        left join brands b on m.id_motobrand=b.idbrands");
                        $motoes= mysqli_fetch_all($motoes);
                        foreach ($motoes as $moto) {
                        ?>
                    <div class="books-item-oneis">
                        <div class="book-img-cont"> <img class="book-img" src="<?=$moto[4]?>" alt=""></div>
                        <div class="book-header-cont"><?=$moto[1]?></div>
                        <div class="book-params">
                            <p>Маркка: <?=$moto[2]?></p>
                        </div>
                        <div class="book-price-cont"><?=$moto[3]?> руб</div>
                        <div class="book-buy-cont"><button class="add-to-cart" data-articul="<?=$moto[0]?>">В Корзину</button></div>
                    </div>  
                    <?php
                    }?>

                </div>
            </div>
        </div>
        <div class="right-cont">
            <div class="korz-cont">
                <div class="right-cont-header">
                    <img src="img/free-icon-purchase-7078316.png" width="50" alt="Корзина"> Корзина
                </div>
                <div  class="purch-cont">
                    <!-- Нет выбранных товаров -->
                    
                    <div  id="purch-cont" class="purch-el">
                        <div class="book-pay-header">s
                            <div id="book-pay-header2">s</div>
                            <div id="cart-count"></div>
                        </div>
                        <div id="book-pay-cout" class="book-pay-cout"></div>
                        <div class="plus-minus">
                            <div class="plus">+</div>
                            <div class="minus">-</div>
                        </div>
                        <div class="book-pay-close">x</div>
                    </div>
                </div>
                <div class="opl-cont">
                    <p id="afbalance" class="af-balance"></p>
                    <p id="btn-pay" class="btn-pay">Купить</p>
                </div>
            </div>
        </div>
    </div>
    <script>
        var cart={};
        $(function(){
            checkCart();
            var obj = {}; // "associative array" or Object
            var a = ['a', 'b', 'c', 'd'];
            for(index in a) {
                if (index % 2 == 0) {
                    var key = a[index];
                    var val = a[index+1];
                    obj[key] = val;
                }
            }
            var s = "<?=$moto[0]?>";
            var veloes = <?php echo json_encode($tovari); ?>;
            var motoes = <?php echo json_encode($motoes); ?>;
            const velo_moto = veloes.concat(motoes);
            //console.log(veloes);
            //console.log(motoes);
            //console.log(veloes[0][0])
            //console.log(motoes[0][1])
            // console.log(velo_moto);
            //console.log(velo_moto[0])
            //console.log(velo_moto[0][0])
            var balance = 1250;
            var t = 150*4;
            var x = t;
            ner.textContent = balance;
            afbalance.textContent = x;
            let btn_pay = document.getElementById("btn-pay");
            btn_pay.addEventListener("click", myfun);
            function myfun () {
                (ner.textContent <x) ? 
                alert('Недостаточно денег для заказа'): 
                balance -=x;
                ner.textContent = balance;
            };
        
   
            const data = {};
            $('.add-to-cart').on('click', addToCart);

            function addToCart(){
                var articul = $(this).attr("data-articul");
                if(cart[articul]!==undefined){
                cart[articul]++;
                }
                else{
                    cart[articul]=1;
                }
                localStorage.setItem('cart', JSON.stringify(cart));
                //console.log(cart);
            };
            function checkCart(){
                //проверка наличие корзины в localStorage
               // console.log(localStorage.getItem('ddd'));
                if(localStorage.getItem('cart')!==null){
                    cart = JSON.parse(localStorage.getItem('cart'));
                }
                console.log(cart)
            }
        
            function showMiniCarrt(){
                //вывод корзины
                for(var s in  cart){
                    for( var v in velo_moto){
                        if(s!== velo_moto[v][0]){
                           /* var myNode = document.getElementById("purch-cont");
                           // alert(myNode)
                                while (myNode.firstChild) {
                                    myNode.removeChild(myNode.firstChild);
                                }
                                myNode.setc*/
                        }
                        else{
                            // console.log(console.log(s+" "+cart[s] +" ---- "+velo_moto[v][0]+" "+velo_moto[v][1]+" "+velo_moto[v][2]+" "+velo_moto[v][3]))
                            var book_pay_header = document.getElementById('book-pay-header2').innerText += velo_moto[v][1];
                            var eee =  document.getElementById('cart-count').textContent = cart[s] + ' шт.';
                            var book_pay_cout = document.getElementById('book-pay-cout').innerText +=velo_moto[v][5] + ' руб.';

                       
                        }
                    }
                }
            }
            showMiniCarrt()
        });
    </script>
</body>
</html>
<!-- if(event.target.classList.contains('add-to-cart')){
                    let articul = event.target.dataset['articul'];
                    if(data[articul]!== undefined){
                        data[articul]++;
                    }
                    else{
                        data[articul]=cart[articul];
                        data[articul]=1;
                    }   
                    localStorage.setItem('cart',JSON.stringify(data));
                }
                console.log(data[articul]['count'])
                <div  id="purch-cont" class="purch-el">
                        <div class="book-pay-header">Дизайн - это работа <br><em>2 шт.</em>
                        </div>
                        <div class="book-pay-cout">150 руб.</div>
                        <div class="plus-minus">
                            <div class="plus">+</div>
                            <div class="minus">-</div>
                        </div>
                        <div class="book-pay-close">x</div>
                    </div> -->

                    <!-- var eee =  document.getElementById('cart-count').innerText = cart[s] + ' шт.'; -->